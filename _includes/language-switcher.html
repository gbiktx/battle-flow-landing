{% assign lang = page.lang | default: site.default_lang | default: "en" %}

<div class="language-switcher">
  <label for="language-select" class="language-switcher__label">üåê</label>
  <select id="language-select" onchange="switchLanguage(this.value)" aria-label="Select Language" class="language-switcher__select">
    <option value="en" {% if lang == "en" %}selected{% endif %}>English</option>
    <option value="es" {% if lang == "es" %}selected{% endif %}>Espa√±ol</option>
    <option value="fr" {% if lang == "fr" %}selected{% endif %}>Fran√ßais</option>
    <option value="de" {% if lang == "de" %}selected{% endif %}>Deutsch</option>
    <option value="it" {% if lang == "it" %}selected{% endif %}>Italiano</option>
    <option value="pt" {% if lang == "pt" %}selected{% endif %}>Portugu√™s</option>
    <option value="zh-Hans" {% if lang == "zh-Hans" %}selected{% endif %}>ÁÆÄ‰Ωì‰∏≠Êñá</option>
    <option value="zh-Hant" {% if lang == "zh-Hant" %}selected{% endif %}>ÁπÅÈ´î‰∏≠Êñá</option>
    <option value="ja" {% if lang == "ja" %}selected{% endif %}>Êó•Êú¨Ë™û</option>
    <option value="ko" {% if lang == "ko" %}selected{% endif %}>ÌïúÍµ≠Ïñ¥</option>
  </select>
</div>

<style>
.language-switcher {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  position: relative;
}

.language-switcher__label {
  font-size: 1.25rem;
  cursor: pointer;
  user-select: none;
}

.language-switcher__select {
  padding: 0.5rem 2rem 0.5rem 0.75rem;
  font-size: 0.95rem;
  border: 2px solid #ddd;
  border-radius: 6px;
  background-color: white;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M10.293 3.293L6 7.586 1.707 3.293A1 1 0 00.293 4.707l5 5a1 1 0 001.414 0l5-5a1 1 0 10-1.414-1.414z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.5rem center;
  background-size: 12px;
  transition: all 0.2s ease;
  font-weight: 500;
  min-height: 40px;
}

.language-switcher__select:hover {
  border-color: #5A51FE;
  box-shadow: 0 2px 8px rgba(90, 81, 254, 0.15);
}

.language-switcher__select:focus {
  outline: none;
  border-color: #5A51FE;
  box-shadow: 0 0 0 3px rgba(90, 81, 254, 0.15);
}

@media (max-width: 768px) {
  .language-switcher {
    width: 100%;
    justify-content: center;
    margin: 16px 0;
  }

  .language-switcher__select {
    flex: 1;
    max-width: 300px;
    min-height: 44px;
    font-size: 1rem;
  }

  .language-switcher__select:active {
    transform: scale(0.98);
  }
}
</style>

<script>
function switchLanguage(lang) {
  const langMap = {
    'en': '/',
    'es': '/es/',
    'fr': '/fr/',
    'de': '/de/',
    'it': '/it/',
    'pt': '/pt/',
    'zh-Hans': '/zh-hans/',
    'zh-Hant': '/zh-hant/',
    'ja': '/ja/',
    'ko': '/ko/'
  };

  if (langMap[lang]) {
    // Save the user's language preference
    localStorage.setItem('preferredLanguage', lang);
    window.location.href = langMap[lang];
  }
}

// Automatic browser language detection
(function() {
  // Check if user has manually selected a language before
  const savedLang = localStorage.getItem('preferredLanguage');
  if (savedLang) {
    // User has a saved preference, don't auto-redirect
    return;
  }

  // Only auto-detect on the homepage (English version)
  const currentPath = window.location.pathname;
  if (currentPath !== '/' && currentPath !== '/index.html') {
    // User is already on a language-specific page
    return;
  }

  // Get browser language
  const browserLang = navigator.language || navigator.userLanguage;

  // Map browser language codes to our supported languages
  const languageMap = {
    'es': 'es',
    'es-ES': 'es',
    'es-MX': 'es',
    'es-AR': 'es',
    'fr': 'fr',
    'fr-FR': 'fr',
    'fr-CA': 'fr',
    'de': 'de',
    'de-DE': 'de',
    'de-AT': 'de',
    'de-CH': 'de',
    'it': 'it',
    'it-IT': 'it',
    'pt': 'pt',
    'pt-BR': 'pt',
    'pt-PT': 'pt',
    'zh-CN': 'zh-Hans',
    'zh-Hans': 'zh-Hans',
    'zh-SG': 'zh-Hans',
    'zh-TW': 'zh-Hant',
    'zh-Hant': 'zh-Hant',
    'zh-HK': 'zh-Hant',
    'ja': 'ja',
    'ja-JP': 'ja',
    'ko': 'ko',
    'ko-KR': 'ko'
  };

  // Try to match the full language code first, then just the language part
  let detectedLang = languageMap[browserLang];
  if (!detectedLang) {
    const langCode = browserLang.split('-')[0];
    detectedLang = languageMap[langCode];
  }

  // If we found a supported language and it's not English, redirect
  if (detectedLang && detectedLang !== 'en') {
    const langMap = {
      'es': '/es/',
      'fr': '/fr/',
      'de': '/de/',
      'it': '/it/',
      'pt': '/pt/',
      'zh-Hans': '/zh-hans/',
      'zh-Hant': '/zh-hant/',
      'ja': '/ja/',
      'ko': '/ko/'
    };

    if (langMap[detectedLang]) {
      window.location.href = langMap[detectedLang];
    }
  }
})();
</script>
